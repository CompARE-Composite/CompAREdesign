summary(lm(y~x))
summary.lm
print.summaryDefault()
print.summaryDefault
setwd("C:/Users/jcortes/My Drive/CompARE package/CompARE-package/CompARE-package")
devtools::document()
devtools::load_all()
samplesize_tte(p0_e1=0.1,
p0_e2=0.1,
HR_e1=0.5,
HR_e2=0.4,
beta_e1 = 1,
beta_e2 = 1,
case=1,
copula = "Frank",
rho = 0.3,
rho_type = "Spearman",
alpha = 0.05,
power = 0.7,
ss_formula = "schoendfeld")
setwd("C:/Users/jcortes/My Drive/CompARE package/CompARE-package/CompARE-package")
devtools::document()
devtools::load_all()
samplesize_tte(p0_e1=0.1,
p0_e2=0.1,
HR_e1=0.5,
HR_e2=0.4,
beta_e1 = 1,
beta_e2 = 1,
case=1,
copula = "Frank",
rho = 0.3,
rho_type = "Spearman",
alpha = 0.05,
power = 0.7,
ss_formula = "schoendfeld")
d <- data.frame(x='a',y='b')
print(d)
print(d,right=FALSE)
d <- data.frame(xxxxxxxxxxxx='a',yyyyyyyyyy='b')
print(d,right=FALSE)
print(d,right=c(FALSE,TRUE))
print(d,right=c(TRUE,TRUE))
z <- list(a=letters[1:3], b=(-pi+0i)^((-2:2)/2), c=c(1,10,100,1000),
d=c("a", "longer", "character", "string"))
format(z, digits = 2)
format(z, digits = 2, justify = "left", trim = FALSE)
d <- cran_downloads(when = "last-month", packages = c("CompAREdesign"))
ggplot(d,aes(x=date,y=count)) + geom_line(color="green",size=1)
library(cranlogs)
library(ggplot2)
d <- cran_downloads(when = "last-month", packages = c("CompAREdesign"))
ggplot(d,aes(x=date,y=count)) + geom_line(color="green",size=1)
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=1)
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=10)
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
d <- cran_downloads(when = "last-month", packages = c("GofCens"))
d
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
d <- cran_downloads(when = "last-month", packages = c("ICGE"))
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
d <- cran_downloads(when = "last-month", packages = c("survmixer"))
d
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
d <- cran_downloads(when = "last-month", packages = c("FHtest"))
d
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
options(warn = -1)
library(MASS,warn.conflicts = FALSE,quietly = TRUE)        # glm.nb
library(car,warn.conflicts = FALSE,quietly = TRUE)         # ShipAccidents; Anova
library(AER,warn.conflicts = FALSE,quietly = TRUE)         # dispersion.test
library(effects,warn.conflicts = FALSE,quietly = TRUE)     # allEffects
library(emmeans,warn.conflicts = FALSE,quietly = TRUE)     # emmeans
library(multcomp,warn.conflicts = FALSE,quietly = TRUE)    # cld
library(multcompView,warn.conflicts = FALSE,quietly = TRUE)# cld
library(tables,warn.conflicts = FALSE,quietly = TRUE)      # tabular
data(ShipAccidents)                                   # data in package AER
ShipAccidents$operation[33]<-"1960-74"                # Correcció dada 33 que està malament
ShipAccidents$construction[33]<-"1960-64"             # Correcció dada 33 que està malament
df <- subset(ShipAccidents , service > 0)
summary(df)
print(tabular(service*operation*construction~(sum+1)*type,df))
hist(ShipAccidents$incidents,br=20)
ShipAccidents
summary(df)
print(tabular(service*operation*construction~(sum+1)*type,df))
hist(ShipAccidents$incidents,br=20)
mp0 <- glm(incidents ~ type, family = poisson,  data = df, offset = log(service))
summary(mp0)
mp0$deviance
qchisq(0.95,mp0$df.res)
1-pchisq(mp0$deviance,mp0$df.residual) # p-valor < 0.05   --> Model no vàlid
dim(df)
X2P <- sum(resid(mp0,type="pearson")^2)
phi <- X2P/mp0$df.residual
phi
# Test formal per dependencia lineal amb esperanza
dispersiontest(mp0, trafo = 1)  # V(Y)=(1+alpha)*mu  --> Y Quasi-poisson
# Test formal per dependencia quadratica amb esperanza
dispersiontest(mp0, trafo = 2)  # V(Y)=mu+alpha*mu^2 --> Y Bin Neg
mqp0 <- glm(incidents ~ type, family=quasipoisson, offset=log(service), data = df)
summary(mp0)
summary(mqp0)
mnb0 <- glm.nb(incidents ~ offset(log(service)) + type, data=df)
summary(mp0)
summary(mnb0)
m1_a <- glm(incidents ~ type + construction + operation + offset(log(service)), family = poisson, data = df)
m1_f <- glm(incidents ~ type * construction * operation + offset(log(service)), family = poisson, data = df)
summary(m1_a)
summary(m1_f)
anova(m1_a,m1_f,test='Chisq')
Anova(m1_f)
m2a <- glm(incidents ~ type * construction + operation, family = poisson, data = df, offset = log(service))
table(df$type,df$construction)
df$TxC <- factor(with(df,paste0(type,'_',construction)))
m2b <- glm(incidents ~ TxC + operation + offset(log(service)), family = poisson, data = df)
summary(m2a)  # Hi ha termes no estimats
summary(m2b)  # Tots els termes estimats però errors estandards grans
## Podem agrupar categories?
emmip(m2a,type ~ construction)
d <- cran_downloads(when = "last-month", packages = c("POMA"))
d
ggplot(d,aes(x=date,y=count)) +
geom_line(color="blue",size=1) +
geom_point(color="blue",size=3)
d
d <- cran_downloads(when = "last-month",
packages = c("CompAREdesign","GofCens","ICGE","survmixer","FHtest","ORdensity"))
d <- cran_downloads(when = "last-month",
packages = c("CompAREdesign","GofCens","ICGE","survmixer","FHtest","ORdensity"))
ggplot(d,aes(x=date,y=count)) +
geom_line(aes(color='package'),size=1) +
geom_point(aes(color='package'),size=3)
ggplot(d,aes(x=date,y=count)) +
geom_line(aes(color=package),size=1) +
geom_point(aes(color=package),size=3)
## Podem agrupar categories?
emmip(m2a,type ~ construction)
emmip(m2a,construction ~ type)
knitr::opts_chunk$set(echo=TRUE)     # Show code?
knitr::opts_chunk$set(eval=TRUE)     # Eval results?
knitr::opts_chunk$set(include=TRUE)  # Show results?
knitr::opts_chunk$set(fig.width=10)  # Fig.width
knitr::opts_chunk$set(fig.height=9)  # Fig.height
show.comments <- TRUE
options(warn = -1)
library(MASS,warn.conflicts = FALSE,quietly = TRUE)        # glm.nb
library(car,warn.conflicts = FALSE,quietly = TRUE)         # ShipAccidents; Anova
library(AER,warn.conflicts = FALSE,quietly = TRUE)         # dispersion.test
library(effects,warn.conflicts = FALSE,quietly = TRUE)     # allEffects
library(emmeans,warn.conflicts = FALSE,quietly = TRUE)     # emmeans
library(multcomp,warn.conflicts = FALSE,quietly = TRUE)    # cld
library(multcompView,warn.conflicts = FALSE,quietly = TRUE)# cld
library(tables,warn.conflicts = FALSE,quietly = TRUE)      # tabular
data(ShipAccidents)                                   # data in package AER
ShipAccidents$operation[33]<-"1960-74"                # Correcció dada 33 que està malament
ShipAccidents$construction[33]<-"1960-64"             # Correcció dada 33 que està malament
df <- subset(ShipAccidents , service > 0)
summary(df)
print(tabular(service*operation*construction~(sum+1)*type,df))
hist(ShipAccidents$incidents,br=20)
mp0 <- glm(incidents ~ type, family = poisson,  data = df, offset = log(service))
summary(mp0)
mp0$deviance; qchisq(0.95,mp0$df.res)  # D > punt crític  --> Model no vàlid
1-pchisq(mp0$deviance,mp0$df.residual) # p-valor < 0.05   --> Model no vàlid
# Estimar parámetre de sobredispersio
X2P <- sum(resid(mp0,type="pearson")^2)
phi <- X2P/mp0$df.residual
phi
# Test formal per dependencia lineal amb esperanza
dispersiontest(mp0, trafo = 1)  # V(Y)=(1+alpha)*mu  --> Y Quasi-poisson
# Test formal per dependencia quadratica amb esperanza
dispersiontest(mp0, trafo = 2)  # V(Y)=mu+alpha*mu^2 --> Y Bin Neg
mqp0 <- glm(incidents ~ type, family=quasipoisson, offset=log(service), data = df)
summary(mp0)
summary(mqp0)
mnb0 <- glm.nb(incidents ~ offset(log(service)) + type, data=df)
summary(mp0)
summary(mnb0)
m1_a <- glm(incidents ~ type + construction + operation + offset(log(service)), family = poisson, data = df)
m1_f <- glm(incidents ~ type * construction * operation + offset(log(service)), family = poisson, data = df)
summary(m1_a)
summary(m1_f)
anova(m1_a,m1_f,test='Chisq')
Anova(m1_f)
m2a <- glm(incidents ~ type * construction + operation, family = poisson, data = df, offset = log(service))
table(df$type,df$construction)
df$TxC <- factor(with(df,paste0(type,'_',construction)))
m2b <- glm(incidents ~ TxC + operation + offset(log(service)), family = poisson, data = df)
summary(m2a)  # Hi ha termes no estimats
summary(m2b)  #
## Podem agrupar categories?
emmip(m2a,type ~ construction)
knitr::opts_chunk$set(echo=TRUE)     # Show code?
knitr::opts_chunk$set(eval=TRUE)     # Eval results?
knitr::opts_chunk$set(include=TRUE)  # Show results?
knitr::opts_chunk$set(fig.width=10)  # Fig.width
knitr::opts_chunk$set(fig.height=9)  # Fig.height
show.comments <- TRUE
options(warn = -1)
library(MASS,warn.conflicts = FALSE,quietly = TRUE)        # glm.nb
library(car,warn.conflicts = FALSE,quietly = TRUE)         # ShipAccidents; Anova
library(AER,warn.conflicts = FALSE,quietly = TRUE)         # dispersion.test
library(effects,warn.conflicts = FALSE,quietly = TRUE)     # allEffects
library(emmeans,warn.conflicts = FALSE,quietly = TRUE)     # emmeans
library(multcomp,warn.conflicts = FALSE,quietly = TRUE)    # cld
library(multcompView,warn.conflicts = FALSE,quietly = TRUE)# cld
library(tables,warn.conflicts = FALSE,quietly = TRUE)      # tabular
data(ShipAccidents)                                   # data in package AER
ShipAccidents$operation[33]<-"1960-74"                # Correcció dada 33 que està malament
ShipAccidents$construction[33]<-"1960-64"             # Correcció dada 33 que està malament
df <- subset(ShipAccidents , service > 0)
summary(df)
print(tabular(service*operation*construction~(sum+1)*type,df))
hist(ShipAccidents$incidents,br=20)
mp0 <- glm(incidents ~ type, family = poisson,  data = df, offset = log(service))
summary(mp0)
mp0$deviance; qchisq(0.95,mp0$df.res)  # D > punt crític  --> Model no vàlid
1-pchisq(mp0$deviance,mp0$df.residual) # p-valor < 0.05   --> Model no vàlid
# Estimar parámetre de sobredispersio
X2P <- sum(resid(mp0,type="pearson")^2)
phi <- X2P/mp0$df.residual
phi
# Test formal per dependencia lineal amb esperanza
dispersiontest(mp0, trafo = 1)  # V(Y)=(1+alpha)*mu  --> Y Quasi-poisson
# Test formal per dependencia quadratica amb esperanza
dispersiontest(mp0, trafo = 2)  # V(Y)=mu+alpha*mu^2 --> Y Bin Neg
mqp0 <- glm(incidents ~ type, family=quasipoisson, offset=log(service), data = df)
summary(mp0)
summary(mqp0)
mnb0 <- glm.nb(incidents ~ offset(log(service)) + type, data=df)
summary(mp0)
summary(mnb0)
m1_a <- glm(incidents ~ type + construction + operation + offset(log(service)), family = poisson, data = df)
m1_f <- glm(incidents ~ type * construction * operation + offset(log(service)), family = poisson, data = df)
summary(m1_a)
summary(m1_f)
anova(m1_a,m1_f,test='Chisq')
Anova(m1_f)
m2a <- glm(incidents ~ type * construction + operation, family = poisson, data = df, offset = log(service))
table(df$type,df$construction)
df$TxC <- factor(with(df,paste0(type,'_',construction)))
m2b <- glm(incidents ~ TxC + operation + offset(log(service)), family = poisson, data = df)
summary(m2a)  # Hi ha termes no estimats
summary(m2b)  # Tots els termes estimats però errors estandards grans
## Podem agrupar categories?
emmip(m2a,type ~ construction)
knitr::opts_chunk$set(echo=TRUE)     # Show code?
knitr::opts_chunk$set(eval=TRUE)     # Eval results?
knitr::opts_chunk$set(include=TRUE)  # Show results?
knitr::opts_chunk$set(fig.width=10)  # Fig.width
knitr::opts_chunk$set(fig.height=9)  # Fig.height
show.comments <- TRUE
options(warn = -1)
library(MASS,warn.conflicts = FALSE,quietly = TRUE)        # glm.nb
library(car,warn.conflicts = FALSE,quietly = TRUE)         # ShipAccidents; Anova
library(AER,warn.conflicts = FALSE,quietly = TRUE)         # dispersion.test
library(effects,warn.conflicts = FALSE,quietly = TRUE)     # allEffects
library(emmeans,warn.conflicts = FALSE,quietly = TRUE)     # emmeans
library(multcomp,warn.conflicts = FALSE,quietly = TRUE)    # cld
library(multcompView,warn.conflicts = FALSE,quietly = TRUE)# cld
library(tables,warn.conflicts = FALSE,quietly = TRUE)      # tabular
data(ShipAccidents)                                   # data in package AER
# ShipAccidents$operation[33]<-"1960-74"                # Correcció dada 33 que està malament
# ShipAccidents$construction[33]<-"1960-64"             # Correcció dada 33 que està malament
df <- subset(ShipAccidents , service > 0)
summary(df)
print(tabular(service*operation*construction~(sum+1)*type,df))
hist(ShipAccidents$incidents,br=20)
mp0 <- glm(incidents ~ type, family = poisson,  data = df, offset = log(service))
summary(mp0)
mp0$deviance; qchisq(0.95,mp0$df.res)  # D > punt crític  --> Model no vàlid
1-pchisq(mp0$deviance,mp0$df.residual) # p-valor < 0.05   --> Model no vàlid
# Estimar parámetre de sobredispersio
X2P <- sum(resid(mp0,type="pearson")^2)
phi <- X2P/mp0$df.residual
phi
# Test formal per dependencia lineal amb esperanza
dispersiontest(mp0, trafo = 1)  # V(Y)=(1+alpha)*mu  --> Y Quasi-poisson
# Test formal per dependencia quadratica amb esperanza
dispersiontest(mp0, trafo = 2)  # V(Y)=mu+alpha*mu^2 --> Y Bin Neg
mqp0 <- glm(incidents ~ type, family=quasipoisson, offset=log(service), data = df)
summary(mp0)
summary(mqp0)
mnb0 <- glm.nb(incidents ~ offset(log(service)) + type, data=df)
summary(mp0)
summary(mnb0)
m1_a <- glm(incidents ~ type + construction + operation + offset(log(service)), family = poisson, data = df)
m1_f <- glm(incidents ~ type * construction * operation + offset(log(service)), family = poisson, data = df)
summary(m1_a)
summary(m1_f)
anova(m1_a,m1_f,test='Chisq')
Anova(m1_f)
m2a <- glm(incidents ~ type * construction + operation, family = poisson, data = df, offset = log(service))
table(df$type,df$construction)
df$TxC <- factor(with(df,paste0(type,'_',construction)))
m2b <- glm(incidents ~ TxC + operation + offset(log(service)), family = poisson, data = df)
summary(m2a)  # Hi ha termes no estimats
summary(m2b)  # Tots els termes estimats però errors estandards grans
## Podem agrupar categories?
emmip(m2a,type ~ construction)
m2a <- glm(incidents ~ type * construction + operation, family = poisson, data = df, offset = log(service))
table(df$type,df$construction)
df$TxC <- factor(with(df,paste0(type,'_',construction)))
m2b <- glm(incidents ~ TxC + operation + offset(log(service)), family = poisson, data = df)
summary(m2a)  # Hi ha termes no estimats
summary(m2b)  # Tots els termes estimats però errors estandards grans
## Podem agrupar categories?
emmip(m2a,type ~ construction)
table(df$type2,df$construction2)
table(df$type2,df$construction2)
df$construction2 <- factor(ifelse(df$construction %in% c('1970-74','1975-79'),'1970-79','1960-69'))
df$type2 <- factor(ifelse(df$type %in% c('B','C','E'),'TypeBCE','TypeAD'))
table(df$type2,df$construction2)
## Ajustem nou model
m2c <- glm(incidents ~ type2 * construction2 + operation, family = poisson, data = df,offset=log(service))
summary(m2c)
AIC(m1_a,m2c)
## Avaluem la sobredispersió
dispersiontest(m1_a,trafo=2)
dispersiontest(m1_a,trafo=1)
# Per deviança
(D <- m1_a$deviance)
qchisq(0.95,m1_a$df.residual)    # Punt crític
(D <- m1_a$deviance)
qchisq(0.95,m1_a$df.residual)    # Punt crític
1 - pchisq(D,m1_a$df.residual)   # P-valor
# Pearson generalitzat
(X2P <- sum(resid(m1_a,type="pearson")^2))
(X2P <- sum(resid(m1_a,type="pearson")^2))
qchisq(0.95,m1_a$df.residual)    # Punt crític
1 - pchisq(X2P,m1_a$df.residual) # P-valor
residualPlots(m1_a)
residualPlot(m1_a)
influenceIndexPlot(m1_a,id=list(vars=c("Cook", "hat"), n=5))
influencePlot(m1_a)
# Dades influents i residus
influenceIndexPlot(m1_a,id=list(vars=c("Cook", "hat"), n=5))
influencePlot(m1_a)
m1_a2 <- glm(incidents ~ type + construction + operation, family = poisson, data = df[-30,], offset = log(service))
cbind(coef(m1_a),coef(m1_a2)) # Canvia tipus E
## Residus grans
outlierTest(m1_a)
plot(df$incidents/df$service,predict(m1_a,type="response")/df$service,pch=NA,log='xy',ylab='Precticted rate',xlab='Observed rate')
text(df$incidents/df$service,predict(m1_a,type="response")/df$service,rownames(df),cex=0.8,font=2)
plot(df$incidents/df$service,predict(m1_a,type="response")/df$service,pch=NA,log='xy',ylab='Precticted rate',xlab='Observed rate')
text(df$incidents/df$service,predict(m1_a,type="response")/df$service,rownames(df),cex=0.8,font=2)
abline(0,1,lty=2)
## Taxes mensuals segons cada variable
cld(emmeans(m1_a,~operation|service,at=list(service=1),type='response'))
cld(emmeans(m1_a,~type|service,at=list(service=1),type='response'))
cld(emmeans(m1_a,~construction|service,at=list(service=1),type='response'))
## All Effects
plot(allEffects(m1_a),ask=FALSE)
lambda <- predict(m1_a,
data.frame(type='A',construction='1975-79',operation='1975-79',service=60),
type='response')
exp(-lambda)
lambda <- predict(m1_a,
data.frame(type='A',construction='1975-79',operation='1975-79',service=12),
type='response')
exp(-lambda)
lambda <- predict(m1_a,
data.frame(type='A',construction='1975-79',operation='1975-79',service=12),
type='response')
lambda
lambda <- predict(m1_a,
data.frame(type='A',construction='1975-79',operation='1975-79',service=6),
type='response')
lambda
load('ceb.RData')
options(warn = -1)
suppressMessages(library(effects,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(MASS,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(AER,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(car,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(lmtest,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(emmeans,warn.conflicts = TRUE,quietly=TRUE))
suppressMessages(library(multcomp,warn.conflicts = FALSE,quietly = TRUE))
suppressMessages(library(multcompView,warn.conflicts = FALSE,quietly = TRUE))
setwd('Datasets')
load('ceb.RData')
ceb$logn <- log(ceb$n)
head(ceb)             # Primers registres
summary(ceb)          # Descriptiva numèrica
hist(ceb$y,breaks=20) # variable resposta
par(mfrow=c(1,3))
# Descriptiva bivariant
par(mfrow=c(1,3))
boxplot(mean~dur,ceb)
boxplot(mean~res,ceb)
boxplot(mean~educ,ceb)
## Sobre dispersió
index.dispersio <- function(v,m) mean(v/m)
with(ceb,tapply(var,dur,index.dispersio,m=mean))
with(ceb,tapply(var,res,index.dispersio,m=mean))
with(ceb,tapply(var,educ,index.dispersio,m=mean))
m1a <- glm(y ~ offset(logn) + res + educ, family=poisson, data=ceb)
m1b <- glm(y ~ offset(logn) + res * educ, family=poisson, data=ceb)
anova(m1a,m1b,test='Chisq')
X2DER <- sum(resid(m1b,type="pearson")^2)
phi <- X2DER/m1b$df.residual
phi
# Sobredispersió amb dispersion.test
dispersiontest(m1b)
dispersiontest(m1b, trafo=2)
## Amb t.test
mu_hat <- fitted(m1b)                                  # mitjana estimada
var_hat <- ((ceb$y-mu_hat)^2 - ceb$y)                  # variància estimada
t.test(var_hat/mu_hat,mu = 1, alternative = 'greater')
# Sobredispersió amb dispersion.test
dispersiontest(m1b)
## Amb linear regression
mu_hat <- fitted(m1b)
aux <- ((ceb$y-mu_hat)^2 - ceb$y)/mu_hat
summary(mod <- lm(aux ~ 1))                 # Coeficient de dispersió
pnorm(summary(mod)$coef[1, 3],lower=FALSE)  # pvalor amb Normal
summary(mod <- lm(aux ~ 1))                 # Coeficient de dispersió
dispersiontest
aux <- ((ceb$y-mu_hat)^2 - ceb$y)/mu_hat
sqrt(length(aux)) * mean(aux)/sd(aux)
mean(aux) + 1                               # Estimacio
summary(mod <- lm(aux ~ 1))                 # Coeficient de dispersió
aux <- ((ceb$y-mu_hat)^2)/mu_hat
summary(mod <- lm(aux ~ 1))                 # Coeficient de dispersió
mu_hat <- fitted(m1b)                                  # mitjana estimada
var_hat <- ((ceb$y-mu_hat)^2 - ceb$y)                  # variància estimada
t.test(var_hat/mu_hat,mu = 1, alternative = 'greater')
m2a <- glm.nb(y ~ offset(logn) + res * educ, data=ceb)
m2b <- glm(y ~ offset(logn) + res * educ, family=neg.bin(theta=m2a$theta), data=ceb)
AIC(m1b,m2b)
m3a <- glm(y ~ offset(logn) + res + educ + dur, family=poisson, data=ceb)
m3b <- glm(y ~ offset(logn) + res * educ * dur , family=poisson, data=ceb)
anova(m3a,m3b,test='Chisq')
Anova(m3b)
cld(emmeans(m3a, ~res|logn,at=list(logn=0),type='response'))
cld(emmeans(m3a, ~educ|logn,at=list(logn=0),type='response'))
cld(emmeans(m3a, ~dur|logn,at=list(logn=0),type='response'))
##-- Interpretació a mà
coef(m3a)[1]                                     # Intercept --> Logaritme nb esperat de fills per dona del grup 0-4, Suva, none
exp(coef(m3a)[1])                                # exp(Intercept) Nb esperat fills per dona del grup referencia
head(predict(m3a,type="response"))               # Nb total de fills per cada grup dels 6 primers
head(predict(m3a,type="response"))/ceb$n[1:6]    # taxa de fills per cada dona en els 6 primers grups
plot(ceb$y,predict(m3a,type="response"),log='xy')# Comparativa de prediccions i recomptes
plot(ceb$y,predict(m3a,type="response"),log='xy')# Comparativa de prediccions i recomptes
abline(0,1,lty=2)
Anova(m3a)
m3a$dev
m3a$df.residual
# Test deviança  P(X2(59)>70.66)=0.14 >>0.05 -> H0 ACC
1 - pchisq(m3a$dev,m3a$df.residual)
# Estimo paràmetre sobredispersió
X2DER <- sum(resid(m3a,type="pearson")^2)
phi <- X2DER/m3a$df.residual
phi
dispersiontest(m3a,trafo=1) # V(Y|X)=(1+alpha)E(Y)      -> Model pseuversemblants
dispersiontest(m3a,trafo=2) # V(Y|X)=E(Y)+alpha*E(Y)^2  -> Y Binomial Negativa generalitzada
residualPlots(m3a, layout=c(3, 2))
# Residus grans. Mal explicats pel model
outlierTest(m3a)
# Dades influents
influenceIndexPlot(m3a,id=list(method=abs(cooks.distance(m3a)),n=5))
ll <- influencePlot(m3a,id=list(method=abs(cooks.distance(m3a)),n=5))
ceb[row.names(ll),]
d <- cran_downloads(from='2021-01-01', to='last-day',
packages = c("CompAREdesign","GofCens","ICGE","survmixer","FHtest","ORdensity"))
library(cranlogs)
library(ggplot2)
d <- cran_downloads(from='2021-01-01', to='last-day',
packages = c("CompAREdesign","GofCens","ICGE","survmixer","FHtest","ORdensity"))
d
ggplot(d,aes(x=date,y=count)) +
geom_line(aes(color=package),size=1) +
geom_point(aes(color=package),size=3)
months(d$date)
library(lubridate)
month(d$date)
d$month <- month(d$date)
d$date2 <- as.Date(paste('2021-',d$month,'-01'))
d$month <- month(d$date)
d$date2 <- as.Date(paste('2021-',d$month,'-01'))
d$date2 <- as.Date(paste('2021-',ifelse(d$month<=9,'0',''),d$month,'-01'))
paste('2021-',ifelse(d$month<=9,'0',''),d$month,'-01')
d$date2 <- as.Date(paste0('2021-',ifelse(d$month<=9,'0',''),d$month,'-01'))
d$date2 <- as.Date(paste0('2021-',d$month,'-01'))
d$date2
ggplot(d,aes(x=date2,y=count)) +
geom_line(aes(color=package),size=1) +
geom_point(aes(color=package),size=3)
d2 <- aggregate(x=d$count,by=list(d$month,d$package),FUN="sum")
d2
names(d2) <- c('date','package','count')
d2 <- aggregate(x=d$count,by=list(d$date2,d$package),FUN="sum")
d2
names(d2) <- c('date','package','count')
ggplot(d2,aes(x=date,y=count)) +
geom_line(aes(color=package),size=1) +
geom_point(aes(color=package),size=3)
